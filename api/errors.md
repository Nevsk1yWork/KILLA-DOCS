# Ошибки

{% hint style="info" %}
* **URL для запросов:** `https://proxy.killa.cc/api/v1`
* **Авторизация:** для каждого запроса передавайте токен в заголовке `Authorization: Bearer <token>`.
{% endhint %}

<details>

<summary><strong>Памятка</strong></summary>

* Всегда проверяйте поле `ok`.
* При `ok: false` используйте `error.code` для логики, `error.message` — для текста.
* Покупки/продления не ретрайте «вслепую» (сначала проверьте состояние/баланс).

</details>

### 1) HTTP статусы

| Status | Что означает                          | Что делать                                                  |
| ------ | ------------------------------------- | ----------------------------------------------------------- |
| 401    | отсутствует/неверный токен            | проверьте `Authorization`, при необходимости сбросьте токен |
| 400    | неверный запрос (параметры/валидация) | исправьте параметры, типы и формат                          |
| 5xx    | ошибка upstream/внутренняя ошибка     | повторите позже (см. рекомендации)                          |

### 2) Единый формат ответа

#### Успех:

```json
{
  "ok": true,
  "data": {}
}
```

#### Ошибка:

```json
{
  "ok": false,
  "error": {
    "code": "invalid_request",
    "message": "Bad request",
    "details": null
  }
}
```

### 3) Частые коды ошибок

| code                | Когда бывает                | Что делать                                          |
| ------------------- | --------------------------- | --------------------------------------------------- |
| invalid\_token      | токен не принят             | проверьте заголовок `Authorization: Bearer <token>` |
| invalid\_request    | неверные параметры/формат   | сверяйте поля/типы/обязательные параметры           |
| insufficient\_funds | недостаточно средств        | пополните баланс или уменьшите объём покупки        |
| provider\_error     | временная ошибка поставщика | аккуратный повтор (см. ниже)                        |
| internal\_error     | внутренняя ошибка сервиса   | аккуратный повтор, при повторении — в поддержку     |

### 4) Рекомендации по ретраям

* Для `provider_error` и `5xx`: повтор через **10–30 секунд**, **1–3 попытки**.
* Для `400`: **не ретраить**, исправить запрос.
* Для `401`: проверить токен или **сбросить** и обновить в интеграции.
